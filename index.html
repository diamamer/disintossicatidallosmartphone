<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Disintossicazione da Smartphone</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 1rem; }
    h1 { text-align: center; }
    button { padding: 10px 20px; margin: 10px 0; font-size: 1rem; cursor: pointer; }
    label { display: block; margin-top: 15px; }
    textarea { width: 100%; height: 80px; margin-top: 5px; }
    input[type="checkbox"] { margin-right: 10px; }
    .task { margin-bottom: 10px; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/push.js/1.0.12/push.min.js"></script>
</head>
<body>

  <h1>Planner Disintossicazione da Smartphone</h1>

  <button id="enableNotif">Attiva notifiche</button>

  <section>
    <h2>Check-in Mattutino</h2>
    <label>Quanto tempo hai passato sullo smartphone ieri? (minuti)
      <input type="number" id="timeSpent" min="0" />
    </label>
    <label>Come ti sei sentito dopo?
      <textarea id="feeling"></textarea>
    </label>
  </section>

  <section>
    <h2>Obiettivi per oggi</h2>
    <div class="task"><input type="checkbox" id="limitUse" />Limita l’uso dello smartphone a <input type="number" id="limitMinutes" min="0" style="width: 60px;"> minuti</div>
    <div class="task"><input type="checkbox" id="noPhoneMeals" />Nessuno smartphone durante i pasti</div>
    <div class="task"><input type="checkbox" id="disableNotif" />Spegni le notifiche non essenziali</div>
  </section>

  <section>
    <h2>Auto-riflessione serale</h2>
    <label>Quante volte hai preso lo smartphone senza motivo?
      <input type="number" id="timesPicked" min="0" />
    </label>
    <label>Cosa ti ha aiutato a non usarlo?
      <textarea id="helped"></textarea>
    </label>
    <label>Cosa potresti migliorare domani?
      <textarea id="improve"></textarea>
    </label>
  </section>

  <script>
    // Richiedi permessi notifiche
    document.getElementById('enableNotif').onclick = () => {
      Push.Permission.request();
      alert('Permessi notifiche richiesti! Ti ricorderemo di staccare dallo smartphone ogni ora.');
    };

    // Funzione per inviare notifica
    function sendNotification() {
      Push.create("È ora di staccare dallo smartphone!", {
        body: "Fai una pausa e dedica del tempo a te stesso.",
        icon: 'icons/icon-192.png',
        timeout: 8000,
        onClick: function () {
          window.focus();
          this.close();
        }
      });
    }

    // Invia notifica ogni ora (3600000 ms)
    setInterval(() => {
      if (Push.Permission.has()) {
        sendNotification();
      }
    }, 3600000);

  </script>

  <script>
    // Registrazione service worker per PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('Service Worker registrato'))
        .catch(err => console.error('Service Worker errore:', err));
    }
  </script>

</body>
</html>
